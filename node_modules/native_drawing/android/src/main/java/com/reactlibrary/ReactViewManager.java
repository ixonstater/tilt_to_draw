
package react.drawingmanager;

import com.reactlibrary.R;
import com.facebook.react.bridge.ReadableArray;
import com.facebook.react.uimanager.SimpleViewManager;
import com.facebook.react.uimanager.ThemedReactContext;
import com.facebook.react.uimanager.annotations.ReactProp;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.graphics.Bitmap;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.Color;
import android.graphics.PorterDuff;
import android.content.Context;
import java.util.Vector;
import react.debuglogmanager.Logger;



public class ReactViewManager extends SimpleViewManager<ImageView>{

  public ThemedReactContext ctx;
  private Paint paint;
  private Vector<Vector<Integer>> coords = new Vector<Vector<Integer>>();
  private Logger log;

  public ReactViewManager(){
    this.paint = new Paint(Paint.ANTI_ALIAS_FLAG);
    this.paint.setColor(Color.RED);
    this.log = new Logger();
  }

  @Override
  public String getName(){
    return "NativeImage";
  }
  @Override
  public ImageView createViewInstance(ThemedReactContext reactContext){
    ctx = reactContext;
    DrawingImageView pic = new DrawingImageView(reactContext, this.log, this.paint, this.coords);
    LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams(0,0);
    pic.setLayoutParams(layoutParams);
    // pic.setWillNotDraw(false);
    return pic;
  }

  @ReactProp(name = "bgcolor")
  public void setBGColor(ImageView view, ReadableArray color){
    view.setBackgroundColor(Color.rgb(color.getInt(0), color.getInt(1), color.getInt(2)));
  }

  @ReactProp(name = "triggerdraw")
  public void drawTest(ImageView view, ReadableArray coords){
    Vector<Integer> temp = new Vector<Integer>();
    temp.add(coords.getInt(0));
    temp.add(coords.getInt(1));
    this.coords.add(temp);
    view.invalidate();
  }
}

class DrawingImageView extends ImageView{
  public Logger log;
  public Paint paint;
  public Vector<Vector<Integer>> coords;

  public DrawingImageView(Context context, Logger log, Paint paint, Vector<Vector<Integer>> coords){
    super(context);
    this.paint = paint;
    this.log = log;
    this.coords = coords;
  }

  public void onDraw(Canvas canvas){
    super.onDraw(canvas);
    canvas.drawCircle(50,50,200,this.paint);
    canvas.drawCircle(50,100,200,this.paint);
    canvas.drawCircle(100,100,200,this.paint);
  }
}
